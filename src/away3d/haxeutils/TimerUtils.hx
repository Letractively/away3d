package away3d.haxeutils;

import flash.display.Sprite;
import flash.text.TextField;
import flash.text.TextFieldAutoSize;
import flash.utils.Dictionary;
import flash.utils.getTimer;
import flash.display.DisplayObject;


class TimerUtils extends Sprite  {
	
	private var timeStart:Dictionary;
	private var timeEnd:Dictionary;
	private var nPasses:Dictionary;
	private var timerText:TextField;
	private static var instance:TimerUtils;
	

	public function new() {
		// autogenerated
		super();
		
		// Create a text field
		
		timerText = new TextField();
		timerText.autoSize = TextFieldAutoSize.LEFT;
		addChild(timerText);
		timerText.text = "";
		timeStart = new Dictionary();
		timeEnd = new Dictionary();
		nPasses = new Dictionary();
	}

	public static function getInstance():TimerUtils {
		
		if (instance == null) {
			instance = new TimerUtils();
		}
		return instance;
	}

	public function tickStart(id:String):Void {
		
		timeStart[untyped id] = flash.Lib.getTimer();
	}

	public function tickEnd(id:String):Void {
		
		if (timeStart[untyped id] != null) {
			var timePassed:Int = flash.Lib.getTimer() - timeStart[untyped id];
			var cumulativeTime:Int = 0;
			var iter:Int = 0;
			if (timeEnd[untyped id] != null) {
				cumulativeTime = timeEnd[untyped id];
				iter = nPasses[untyped id];
			}
			timeEnd[untyped id] = timePassed + cumulativeTime;
			nPasses[untyped id] = iter + 1;
		}
	}

	public function display():Void {
		
		var text:String = "";
		var key:String;
		var __keys:Iterator<Dynamic> = untyped (__keys__(timeEnd)).iterator();
		for (key in __keys) {
			text = text + key + " ----> " + timeEnd[untyped key] + " / " + nPasses[untyped key] + "\n";
			
		}

		timerText.text = text;
	}

}

