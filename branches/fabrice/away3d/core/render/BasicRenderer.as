package away3d.core.render{    import away3d.core.*;    import away3d.core.scene.*;    import away3d.core.draw.*;    import away3d.core.block.*;    import flash.utils.*;    import flash.geom.*;    import flash.display.*;		//added	import flash.events.EventDispatcher;	import flash.events.Event;	import away3d.register.AWClass;	import away3d.register.RenderEvent;	//end added    /** Basic renderer implementation */    public class BasicRenderer extends AWClass implements IRenderer    {        private var aFilters:Array;		private var renderEvent:RenderEvent;		private var camera:Camera3D;        public function BasicRenderer(...filters)        {						//added			this.register("BASICRENDERER");			this.renderEvent = new RenderEvent("RENDER");			this.renderEvent.oData = {totalfaces:0,camera:null};			//end added			            this.aFilters = filters;            this.aFilters.push(new ZSortFilter());        }         public function render(view:View3D):void        {						//added			this.dispatchEvent(this.renderEvent);			//end added			            var scene:Scene3D = view.scene;			//added            this.camera = view.camera;			//            var container:Sprite = view.canvas;            var clip:Clipping = view.clip;            var graphics:Graphics = container.graphics;            // get blockers for occlusion culling            var blockerarray:BlockerArray = new BlockerArray(clip);            var blocktraverser:BlockerTraverser = new BlockerTraverser(blockerarray, view);            scene.traverse(blocktraverser);            var blockers:Array = blockerarray.list();            // get lights and drawing primitives            var priarray:PrimitiveArray = new PrimitiveArray(clip, blockers);            var lightarray:LightArray = new LightArray();            var pritraverser:PrimitiveTraverser = new PrimitiveTraverser(priarray, lightarray, view);            scene.traverse(pritraverser);            var primitives:Array = priarray.list();            // apply filters            for each (var filter:IPrimitiveFilter in aFilters)                primitives = filter.filter(primitives, scene, camera, container, clip);            var session:RenderSession = new RenderSession(scene, camera, container, clip, lightarray);            // render all            for each (var primitive:DrawPrimitive in primitives)                primitive.render(session);						//stats			//added			this.renderEvent = new RenderEvent("RENDER");			this.renderEvent.oData = {totalfaces:primitives.length,camera:camera};			//end added        }        public function desc():String        {            return "Basic ["+aFilters.join("+")+"]";        }        public function getActiveCamera():Camera3D        {            return this.camera;        }    }}